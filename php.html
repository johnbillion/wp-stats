<html>

<head>
	<script src="https://cdn.jsdelivr.net/npm/chart.js@4.3.0/dist/chart.umd.min.js"></script>
	<script
		src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation@3.0.1/dist/chartjs-plugin-annotation.min.js"></script>
	<style>
		* {
			box-sizing: border-box;
		}

		canvas {
			margin: 50px 0;
		}

		table {
			border-collapse: collapse;
			border-spacing: 0;
		}

		tr,
		td,
		th {
			border: 1px solid #ccc;
			padding: 10px;
		}

		th {
			text-align: left;
		}

		td {
			text-align: right;
		}
	</style>
</head>

<body>
	<h1>WordPress PHP version usage over time</h1>
	<p>Stats extracted from recent months of <a href="https://docs.google.com/spreadsheets/d/1avaM9ta3SEUhyeEk2eTUHNx0BZKGAFXMJb8Zo3CyyGQ/edit#gid=904528857">the WP PHP usage over time chart</a>.</p>
	<p>* The numbers for August 2023 and beyond are roughly projected based on the change in the prior months.</p>
	<div>
		<canvas id="canvas"
			aria-label="WordPress PHP version usage graph. A tabular representation of this data is available below."
			role="img"></canvas>
		<div id="table"></div>
	</div>
	<script>
		const dataByMonth = {
			'July 2022': {
				'8.2': 0,
				'8.1': 1.027,
				'8.0': 5.816,
				'7.4': 53.914,
				'7.3': 15.248,
				'7.2': 9.759,
				'7.1': 2.329,
				'7.0': 3.304,
				'5.6': 6.085,
			},
			'August 2022': {
				'8.2': 0,
				'8.1': 1.25,
				'8.0': 6.299,
				'7.4': 55.308,
				'7.3': 14.109,
				'7.2': 9.267,
				'7.1': 2.24,
				'7.0': 3.17,
				'5.6': 5.913,
			},
			'September 2022': {
				'8.2': 0.002,
				'8.1': 1.569,
				'8.0': 6.79,
				'7.4': 55.975,
				'7.3': 13.343,
				'7.2': 8.906,
				'7.1': 2.157,
				'7.0': 3.077,
				'5.6': 5.769,
			},
			'October 2022': {
				'8.2': 0.004,
				'8.1': 2,
				'8.0': 7.301,
				'7.4': 56.694,
				'7.3': 12.563,
				'7.2': 8.638,
				'7.1': 2.055,
				'7.0': 2.966,
				'5.6': 5.459,
			},
			'November 2022': {
				'8.2': 0.007,
				'8.1': 2.468,
				'8.0': 8.144,
				'7.4': 56.912,
				'7.3': 11.891,
				'7.2': 8.239,
				'7.1': 1.966,
				'7.0': 2.856,
				'5.6': 5.272,
			},
			'December 2022': {
				'8.2': 0.012,
				'8.1': 3.28,
				'8.0': 8.877,
				'7.4': 56.827,
				'7.3': 11.217,
				'7.2': 7.889,
				'7.1': 1.882,
				'7.0': 2.745,
				'5.6': 5.103,
			},
			'January 2023': {
				'8.2': 0.077,
				'8.1': 4.13,
				'8.0': 9.636,
				'7.4': 56.223,
				'7.3': 10.601,
				'7.2': 7.854,
				'7.1': 1.79,
				'7.0': 2.64,
				'5.6': 4.929,
			},
			'February 2023': {
				'8.2': 0.249,
				'8.1': 5.066,
				'8.0': 10.72,
				'7.4': 55.282,
				'7.3': 10.073,
				'7.2': 7.529,
				'7.1': 1.726,
				'7.0': 2.549,
				'5.6': 4.738,
			},
			'March 2023': {
				'8.2': 0.46,
				'8.1': 6.096,
				'8.0': 11.622,
				'7.4': 54.504,
				'7.3': 9.656,
				'7.2': 7.016,
				'7.1': 1.661,
				'7.0': 2.443,
				'5.6': 4.534,
			},
			'April 2023': {
				'8.2': 0.725,
				'8.1': 7.048,
				'8.0': 12.416,
				'7.4': 53.867,
				'7.3': 9.113,
				'7.2': 6.59,
				'7.1': 1.595,
				'7.0': 2.337,
				'5.6': 4.366,
			},
			'May 2023': {
				'8.2': 1.01,
				'8.1': 7.954,
				'8.0': 12.977,
				'7.4': 53.07,
				'7.3': 8.752,
				'7.2': 6.332,
				'7.1': 1.53,
				'7.0': 2.246,
				'5.6': 4.235,
			},
			'June 2023': {
				'8.2': 1.357, // + 0.347
				'8.1': 8.835, // + 0.881
				'8.0': 13.394, // + 0.417
				'7.4': 51.899, // - 1.171
				'7.3': 8.321, // - 0.431
				'7.2': 6.699, // + 0.367
				'7.1': 1.451, // - 0.079
				'7.0': 2.141, // - 0.105
				'5.6': 4.074, // - 0.161
			},
			'July 2023': {
				'8.2': 2.052, // + 0.695
				'8.1': 9.332, // + 0.497
				'8.0': 14.015, // + 0.621
				'7.4': 51.176, // - 0.723
				'7.3': 7.958, // - 0.363
				'7.2': 6.298, // - 0.401
				'7.1': 1.388, // - 0.063
				'7.0': 2.06, // - 0.081
				'5.6': 3.95, // - 0.124
			},
			'August 2023*': {
				'7.3': 7.595, // - 0.363
				'7.2': 5.897, // - 0.401
				'7.1': 1.325, // - 0.063
				'7.0': 1.979, // - 0.081
			},
			'September 2023*': {
				'7.3': 7.232, // - 0.363
				'7.2': 5.496, // - 0.401
				'7.1': 1.262, // - 0.063
				'7.0': 1.898, // - 0.081
			},
			'October 2023*': {
				'7.3': 6.869, // - 0.363
				'7.2': 5.095, // - 0.401
				'7.1': 1.199, // - 0.063
				'7.0': 1.817, // - 0.081
			},
			'November 2023*': {
				'7.3': 6.506, // - 0.363
				'7.2': 4.694, // - 0.401
				'7.1': 1.136, // - 0.063
				'7.0': 1.736, // - 0.081
			},
			'December 2023*': {
				'7.3': 6.143, // - 0.363
				'7.2': 4.293, // - 0.401
				'7.1': 1.073, // - 0.063
				'7.0': 1.655, // - 0.081
			},
			'January 2024*': {
				'7.3': 5.78, // - 0.363
				'7.2': 3.892, // - 0.401
				'7.1': 1.01, // - 0.063
				'7.0': 1.574, // - 0.081
			},
			'February 2024*': {
				'7.3': 5.417, // - 0.363
				'7.2': 3.491, // - 0.401
				'7.1': 0.947, // - 0.063
				'7.0': 1.493, // - 0.081
			},
			'March 2024*': {
				'7.3': 5.054, // - 0.363
				'7.2': 3.09, // - 0.401
				'7.1': 0.884, // - 0.063
				'7.0': 1.412, // - 0.081
			},
			'April 2024*': {
				'7.3': 4.691, // - 0.363
				'7.2': 2.689, // - 0.401
				'7.1': 0.821, // - 0.063
				'7.0': 1.331, // - 0.081
			},
			'May 2024*': {
				'7.3': 4.328, // - 0.363
				'7.2': 2.288, // - 0.401
				'7.1': 0.758, // - 0.063
				'7.0': 1.25, // - 0.081
			},
			'June 2024*': {
				'7.3': 3.965, // - 0.363
				'7.2': 1.887, // - 0.401
				'7.1': 0.695, // - 0.063
				'7.0': 1.169, // - 0.081
			},
			'July 2024*': {
				'7.3': 3.602, // - 0.363
				'7.2': 1.486, // - 0.401
				'7.1': 0.632, // - 0.063
				'7.0': 1.088, // - 0.081
			},
			'August 2024*': {
				'7.3': 3.239, // - 0.363
				'7.2': 1.085, // - 0.401
				'7.1': 0.569, // - 0.063
				'7.0': 1.007, // - 0.081
			},
		};
		const phpVersions = {
			'8.2': {
				color: 'red',
			},
			'8.1': {
				color: 'green',
			},
			'8.0': {
				color: 'blue',
			},
			'7.4': {
				color: 'orange',
			},
			'7.3': {
				color: 'black',
			},
			'7.2': {
				color: 'deeppink',
			},
			'7.1': {
				color: 'purple',
			},
			'7.0': {
				color: 'brown',
			},
			'5.6': {
				color: 'gray',
			},
		}
		const ctx = document.getElementById('canvas');
		const latestMonth = 'July 2023';
		const phpLabel = {
			type: 'label',
			xValue: latestMonth,
			xAdjust: 50,
			color: '#fff',
			font: {
				size: 11,
			},
			padding: 1,
			callout: {
				display: true,
				side: 0
			},
		};

		new Chart(ctx, {
			type: 'line',
			data: {
				labels: Object.keys(dataByMonth),
				datasets: Object.keys(phpVersions).map((version) => ({
					label: version,
					data: [
						...Object.values(dataByMonth).map((data) => data[version]),
					],
					borderColor: phpVersions[version].color,
				})),
			},
			options: {
				scales: {
					y: {
						ticks: {
							callback: (value, index, ticks) => (value ? `${value}%` : ''),
						}
					}
				},
				plugins: {
					tooltip: {
						callbacks: {
							label: (context) => ( `PHP ${context.dataset.label}: ${context.parsed.y}%` ),
						}
					},
					annotation: {
						annotations: {
							legend82: {
								...phpLabel,
								yValue: dataByMonth[latestMonth]['8.2'],
								backgroundColor: phpVersions['8.2'].color,
								content: [`8.2: ${dataByMonth[latestMonth]['8.2'].toFixed(2)}%`],
								yAdjust: -15,
							},
							legend81: {
								...phpLabel,
								yValue: dataByMonth[latestMonth]['8.1'],
								backgroundColor: phpVersions['8.1'].color,
								content: [`8.1: ${dataByMonth[latestMonth]['8.1'].toFixed(2)}%`],
								yAdjust: -15,
							},
							legend80: {
								...phpLabel,
								yValue: dataByMonth[latestMonth]['8.0'],
								backgroundColor: phpVersions['8.0'].color,
								content: [`8.0: ${dataByMonth[latestMonth]['8.0'].toFixed(2)}%`],
							},
							legend74: {
								...phpLabel,
								yValue: dataByMonth[latestMonth]['7.4'],
								backgroundColor: phpVersions['7.4'].color,
								content: [`7.4: ${dataByMonth[latestMonth]['7.4'].toFixed(2)}%`],
							},
							legend73: {
								...phpLabel,
								yValue: dataByMonth[latestMonth]['7.3'],
								backgroundColor: phpVersions['7.3'].color,
								content: [`7.3: ${dataByMonth[latestMonth]['7.3'].toFixed(2)}%`],
								yAdjust: -10,
							},
							legend72: {
								...phpLabel,
								yValue: dataByMonth[latestMonth]['7.2'],
								backgroundColor: phpVersions['7.2'].color,
								content: [`7.2: ${dataByMonth[latestMonth]['7.2'].toFixed(2)}%`],
							},
							legend71: {
								...phpLabel,
								yValue: dataByMonth[latestMonth]['7.1'],
								backgroundColor: phpVersions['7.1'].color,
								content: [`7.1: ${dataByMonth[latestMonth]['7.1'].toFixed(2)}%`],
								yAdjust: 10,
							},
							legend70: {
								...phpLabel,
								yValue: dataByMonth[latestMonth]['7.0'],
								backgroundColor: phpVersions['7.0'].color,
								content: [`7.0: ${dataByMonth[latestMonth]['7.0'].toFixed(2)}%`],
							},
							legend56: {
								...phpLabel,
								yValue: dataByMonth[latestMonth]['5.6'],
								backgroundColor: phpVersions['5.6'].color,
								content: [`5.6: ${dataByMonth[latestMonth]['5.6'].toFixed(2)}%`],
								yAdjust: -5,
							},
							now: {
								xMin: 'July 2023',
								xMax: 'July 2023',
								borderWidth: 1,
							},
							fivepercent: {
								yMin: 5,
								yMax: 5,
								borderWidth: 1,
							},
						}
					}
				}
			}
		});

		// Dynamically construct a table in the DOM displaying the data from dataByMonth
		const tableContainer = document.getElementById('table');
		const table = document.createElement('table');
		const tableHead = document.createElement('thead');
		const tableBody = document.createElement('tbody');
		const tableHeadRow = document.createElement('tr');
		const tableHeadCell = document.createElement('th');
		tableHeadCell.innerText = 'Month';
		tableHeadRow.appendChild(tableHeadCell);
		Object.keys(phpVersions).forEach((version) => {
			const tableHeadCell = document.createElement('th');
			tableHeadCell.innerText = `PHP ${version}`;
			tableHeadCell.setAttribute('scope', 'col');
			tableHeadRow.appendChild(tableHeadCell);
		});
		tableHead.appendChild(tableHeadRow);

		Object.keys(dataByMonth).forEach((month) => {
			const tableBodyRow = document.createElement('tr');
			const tableBodyHead = document.createElement('th');
			tableBodyHead.innerText = month;
			tableBodyHead.setAttribute('scope', 'row');
			tableBodyRow.appendChild(tableBodyHead);
			Object.keys(phpVersions).forEach((version) => {
				const tableBodyCell = document.createElement('td');
				tableBodyCell.innerText = dataByMonth[month][version] ? dataByMonth[month][version].toFixed(2) + '%' : '';
				tableBodyRow.appendChild(tableBodyCell);
			});
			tableBody.appendChild(tableBodyRow);
		});

		tableContainer.appendChild(table);
		table.appendChild(tableHead);
		table.appendChild(tableBody);
	</script>
</body>

</html>
